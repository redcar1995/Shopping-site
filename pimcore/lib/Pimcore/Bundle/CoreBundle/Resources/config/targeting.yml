services:
    _defaults:
        autowire: true
        autoconfigure: true
        public: false

    GeoIp2\ProviderInterface: '@GeoIp2\Database\Reader'
    GeoIp2\Database\Reader:
        arguments:
            $filename: '%pimcore.geoip.db_file%'

    Pimcore\Targeting\TargetingStorageInterface: '@Pimcore\Targeting\TargetingStorage'
    Pimcore\Targeting\TargetingStorage: ~

    Pimcore\Targeting\TargetGroupResolver:
        lazy: true

    Pimcore\Targeting\DataProvider\GeoIp: ~
    Pimcore\Targeting\DataProvider\Device:
        arguments:
            $cache: '@pimcore.cache.core.pool'

    Pimcore\Targeting\DataProvider\Piwik: ~
    Pimcore\Targeting\DataProvider\Session: ~

    Pimcore\Targeting\DataProviderLocatorInterface: '@Pimcore\Targeting\DataProviderLocator'
    Pimcore\Targeting\DataProviderLocator: ~

    Pimcore\Targeting\ConditionFactoryInterface: '@Pimcore\Targeting\ConditionFactory'
    Pimcore\Targeting\ConditionFactory:
        arguments:
            $conditions: '%pimcore.targeting.conditions%'

    pimcore.targeting.condition_matcher.expression_language:
        class: Symfony\Component\ExpressionLanguage\ExpressionLanguage
        arguments:
            $cache: '@pimcore.cache.core.pool'

    Pimcore\Targeting\ConditionMatcherInterface: '@Pimcore\Targeting\ConditionMatcher'
    Pimcore\Targeting\ConditionMatcher:
        arguments:
            $expressionLanguage: '@pimcore.targeting.condition_matcher.expression_language'

    Pimcore\Targeting\ActionHandlerLocatorInterface: '@Pimcore\Targeting\ActionHandlerLocator'
    Pimcore\Targeting\ActionHandlerLocator: ~

    Pimcore\Targeting\ActionHandler\AssignTargetGroup: ~
    Pimcore\Targeting\ActionHandler\Event: ~
    Pimcore\Targeting\ActionHandler\Redirect: ~

    Pimcore\Targeting\Session\SessionConfigurator:
        tags:
            - { name: pimcore.session.configurator }

    Pimcore\Targeting\Document\DocumentTargetingHandler: ~
